--Drop tables
Drop Table borrowReturn_Fact Cascade constraints;
Drop Table book_Dim Cascade constraints;
Drop Table student_Dim Cascade constraints;
Drop Table time_Dim Cascade constraints;

--Create Tables
create table time_Dim 
(
	timeID number(10) GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1,
	theMonth number(2) not null,
	theQuarter Number(1) not null,
	theYear Number(4) not null
)partition by range(theYear)
(
	partition  yr2020 values less than (2021),
	partition  yr2021 values less than (2022),
	partition  yr2022 values less than (2023),
	Partition yr2023 values less than(MAXVALUE)
);


create table student_Dim 
(
	student_id NUMBER(5) not null,
	student_name VARCHAR2(20) NOT NULL,
	student_gender VARCHAR2(10) NOT NULL,
	student_classYear NUMBER(2) NOT NULL

);
create bitmap index bitmap_index_studentDim_studentGender on student_Dim(student_gender);

create table book_Dim 
(
	book_id NUMBER(10) not null,
	book_title VARCHAR2(200) NOT NULL,
	book_author VARCHAR2(100) NOT NULL,
	book_category VARCHAR2(50)  NOT NULL

);

create table  borrowReturn_Fact
(
	ID number(10) GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1,
	timeID number(10) not null,
	student_id NUMBER(5) not null,
	book_id NUMBER(10) not null,
	quantity number(10),
	fine number(10)
);

create index index_borrowReturnFact_book_id on borrowReturn_Fact(book_id);
create index index_borrowReturnFact_student_id on borrowReturn_Fact(student_id);

--Primary Keys

Alter table time_Dim
Add constraint pk_time_Dim Primary Key (timeID);

Alter table student_Dim
Add constraint pk_student_Dim Primary Key (student_id);

Alter table book_Dim
Add constraint pk_book_Dim Primary Key (book_id);

Alter table borrowReturn_Fact
Add constraint pk_borrowReturn_Fact Primary Key (timeID,student_id,book_id);

Alter table borrowReturn_Fact
Add constraint fk_time_Dim_borrowReturn_Fact
Foreign Key(timeID)
REFERENCES time_Dim(timeID);

Alter table borrowReturn_Fact
Add constraint fk_student_Dim_borrowReturn_Fact
Foreign Key(student_id)
REFERENCES student_Dim(student_id);

Alter table borrowReturn_Fact
Add constraint fk_book_Dim_borrowReturn_Fact
Foreign Key(book_id)
REFERENCES book_Dim(book_id);